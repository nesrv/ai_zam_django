#!/usr/bin/env python3
"""
Скрипт для создания тестового Excel файла для проверки функциональности отправки в DeepSeek
"""

import pandas as pd
import os

def create_test_excel():
    """Создает тестовый Excel файл с данными о строительном проекте"""
    
    # Данные о ресурсах
    resources_data = {
        'Ресурс': [
            'Бетон М300',
            'Арматура А500С',
            'Кирпич керамический',
            'Цемент М400',
            'Песок строительный',
            'Щебень фр. 5-20',
            'Рабочие-каменщики',
            'Машинист крана',
            'Прораб'
        ],
        'Единица измерения': [
            'м³',
            'тонн',
            'тыс.шт',
            'тонн',
            'м³',
            'м³',
            'чел-час',
            'маш-час',
            'чел-час'
        ],
        'Количество': [
            150.5,
            12.8,
            25.0,
            8.5,
            45.2,
            32.1,
            480,
            24,
            120
        ],
        'Цена за единицу': [
            4500,
            65000,
            18500,
            7200,
            1200,
            1800,
            800,
            2500,
            1500
        ],
        'Общая стоимость': [
            677250,
            832000,
            462500,
            61200,
            54240,
            57780,
            384000,
            60000,
            180000
        ]
    }
    
    # Создаем DataFrame
    df = pd.DataFrame(resources_data)
    
    # Добавляем итоговую строку
    total_row = {
        'Ресурс': 'ИТОГО',
        'Единица измерения': '',
        'Количество': '',
        'Цена за единицу': '',
        'Общая стоимость': df['Общая стоимость'].sum()
    }
    
    df = pd.concat([df, pd.DataFrame([total_row])], ignore_index=True)
    
    # Сохраняем в Excel файл
    filename = 'test_construction_resources.xlsx'
    filepath = os.path.join(os.path.dirname(__file__), filename)
    
    with pd.ExcelWriter(filepath, engine='openpyxl') as writer:
        df.to_excel(writer, sheet_name='Ресурсы', index=False)
        
        # Добавляем второй лист с планом работ
        schedule_data = {
            'Этап работ': [
                'Подготовительные работы',
                'Земляные работы',
                'Устройство фундамента',
                'Возведение стен',
                'Устройство перекрытий',
                'Кровельные работы',
                'Отделочные работы'
            ],
            'Начало': [
                '01.03.2025',
                '05.03.2025',
                '15.03.2025',
                '01.04.2025',
                '15.05.2025',
                '01.06.2025',
                '15.06.2025'
            ],
            'Окончание': [
                '04.03.2025',
                '14.03.2025',
                '31.03.2025',
                '14.05.2025',
                '31.05.2025',
                '14.06.2025',
                '31.07.2025'
            ],
            'Длительность (дни)': [
                4,
                10,
                17,
                44,
                17,
                14,
                47
            ],
            'Стоимость (руб)': [
                150000,
                280000,
                850000,
                1200000,
                650000,
                420000,
                800000
            ]
        }
        
        schedule_df = pd.DataFrame(schedule_data)
        schedule_df.to_excel(writer, sheet_name='План работ', index=False)
    
    print(f"Тестовый Excel файл создан: {filepath}")
    print(f"Содержит {len(df)-1} ресурсов на общую сумму {df.iloc[-1]['Общая стоимость']:,.0f} руб.")
    print(f"План работ на {len(schedule_df)} этапов")
    
    return filepath

if __name__ == "__main__":
    create_test_excel()