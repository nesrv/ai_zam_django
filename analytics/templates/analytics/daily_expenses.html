{% extends 'base/base.html' %}
{% load static %}

{% block title %}–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ - AI-ZAM{% endblock %}

{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
{% endblock %}

{% block extra_styles %}
<style>
    /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
    body {
        overflow-x: hidden;
    }
    
    .finance-dashboard {
        position: relative;
        min-height: 100vh;
        padding-bottom: 3rem;
    }
    
    .dashboard-header {
        text-align: center;
        margin-bottom: 2rem;
        position: relative;
        z-index: 10;
    }
    
    .dashboard-title {
        font-size: 2.5rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
        background: linear-gradient(90deg, #00d4ff, #ff00ff, #ffff00);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: gradient-shift 5s ease infinite;
        text-shadow: 0 0 15px rgba(0, 212, 255, 0.5);
    }
    
    .dashboard-subtitle {
        font-size: 1.2rem;
        color: #aaa;
        margin-bottom: 2rem;
    }
    
    /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Å –¥–∞–Ω–Ω—ã–º–∏ */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
        position: relative;
        z-index: 10;
    }
    
    .stat-card {
        background: rgba(0, 0, 0, 0.7);
        border-radius: 15px;
        padding: 1.5rem;
        text-align: center;
        color: white;
        border: 1px solid rgba(0, 212, 255, 0.3);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
        transform: translateY(30px);
        opacity: 0;
        position: relative;
        overflow: hidden;
    }
    
    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.7s;
    }
    
    .stat-card:hover::before {
        left: 100%;
    }
    
    .stat-card:hover {
        transform: translateY(-5px) !important;
        box-shadow: 0 15px 30px rgba(0, 212, 255, 0.3);
        border-color: rgba(0, 212, 255, 0.8);
    }
    
    .stat-icon {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        background: linear-gradient(45deg, #00d4ff, #ff00ff);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    
    .stat-value {
        font-size: 2.2rem;
        font-weight: bold;
        color: #fff;
        margin-bottom: 0.5rem;
        text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
    }
    
    .stat-label {
        font-size: 1rem;
        opacity: 0.8;
        color: #aaa;
    }
    
    /* –ì—Ä–∞—Ñ–∏–∫–∏ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ */
    .charts-container {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
        margin-top: 2rem;
        position: relative;
        z-index: 10;
    }
    
    .chart-wrapper {
        background: rgba(0, 0, 0, 0.7);
        border-radius: 15px;
        padding: 2rem;
        border: 1px solid rgba(0, 212, 255, 0.3);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(10px);
        transform: translateY(50px);
        opacity: 0;
    }
    
    .chart-title {
        color: #00d4ff;
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 1.5rem;
        text-align: center;
        text-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
    }
    
    .chart-canvas-container {
        position: relative;
        height: 400px;
        width: 100%;
    }
    
    /* –ü—Ä–æ–µ–∫—Ç—ã –∏ —Ä–∏—Å–∫–∏ */
    .projects-section {
        margin-top: 3rem;
        position: relative;
        z-index: 10;
        transform: translateY(50px);
        opacity: 0;
    }
    
    .projects-header {
        color: #00d4ff;
        font-size: 1.8rem;
        font-weight: bold;
        margin-bottom: 1.5rem;
        text-align: center;
        text-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
    }
    
    .projects-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
    }
    
    .project-card {
        background: rgba(0, 0, 0, 0.7);
        border-radius: 15px;
        padding: 1.5rem;
        border: 1px solid rgba(0, 212, 255, 0.3);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
    }
    
    .project-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 212, 255, 0.3);
        border-color: rgba(0, 212, 255, 0.8);
    }
    
    .project-name {
        font-size: 1.3rem;
        font-weight: bold;
        color: #fff;
        margin-bottom: 0.5rem;
    }
    
    .project-budget {
        font-size: 1.1rem;
        color: #00d4ff;
        margin-bottom: 1rem;
    }
    
    .project-status {
        display: inline-block;
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: bold;
        margin-bottom: 1rem;
    }
    
    .status-active {
        background: rgba(0, 255, 0, 0.2);
        color: #00ff00;
        border: 1px solid rgba(0, 255, 0, 0.5);
    }
    
    .status-planning {
        background: rgba(255, 165, 0, 0.2);
        color: #ffa500;
        border: 1px solid rgba(255, 165, 0, 0.5);
    }
    
    .status-completed {
        background: rgba(0, 212, 255, 0.2);
        color: #00d4ff;
        border: 1px solid rgba(0, 212, 255, 0.5);
    }
    
    .risk-meter {
        height: 8px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 4px;
        margin-bottom: 0.5rem;
        overflow: hidden;
    }
    
    .risk-level {
        height: 100%;
        border-radius: 4px;
        transition: width 1s ease-in-out;
    }
    
    .risk-low {
        background: linear-gradient(90deg, #00ff00, #99ff00);
    }
    
    .risk-medium {
        background: linear-gradient(90deg, #ffff00, #ffa500);
    }
    
    .risk-high {
        background: linear-gradient(90deg, #ffa500, #ff0000);
    }
    
    .risk-label {
        display: flex;
        justify-content: space-between;
        font-size: 0.8rem;
        color: #aaa;
        margin-bottom: 1rem;
    }
    
    /* ML Insights */
    .ml-insights {
        background: rgba(0, 0, 0, 0.7);
        border-radius: 15px;
        padding: 1.5rem;
        margin-top: 2rem;
        border: 1px solid rgba(0, 212, 255, 0.3);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(10px);
        position: relative;
        z-index: 10;
        transform: translateY(50px);
        opacity: 0;
    }
    
    .ml-insights-title {
        color: #00d4ff;
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 1rem;
        text-align: center;
        text-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
    }
    
    .insight-item {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
        padding: 0.8rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        border-left: 4px solid #00d4ff;
    }
    
    .insight-icon {
        font-size: 1.5rem;
        margin-right: 1rem;
        color: #00d4ff;
    }
    
    .insight-text {
        font-size: 1rem;
        color: #fff;
    }
    
    /* –§–æ–Ω–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã */
    .particles-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
    }
    
    .data-flow {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 2;
        pointer-events: none;
    }
    
    .data-stream {
        position: absolute;
        width: 2px;
        height: 50px;
        background: linear-gradient(to bottom, rgba(0, 212, 255, 0), rgba(0, 212, 255, 0.8), rgba(0, 212, 255, 0));
        border-radius: 50%;
        opacity: 0.5;
        animation: data-flow 3s linear infinite;
    }
    
    @keyframes data-flow {
        0% {
            transform: translateY(-100px);
            opacity: 0;
        }
        10% {
            opacity: 0.8;
        }
        90% {
            opacity: 0.8;
        }
        100% {
            transform: translateY(calc(100vh + 100px));
            opacity: 0;
        }
    }
    
    .glow-effect {
        position: absolute;
        width: 300px;
        height: 300px;
        border-radius: 50%;
        background: radial-gradient(circle, rgba(0, 212, 255, 0.2) 0%, rgba(0, 212, 255, 0) 70%);
        pointer-events: none;
        z-index: 3;
        opacity: 0.5;
        filter: blur(20px);
        animation: glow-pulse 5s ease-in-out infinite;
    }
    
    @keyframes glow-pulse {
        0%, 100% {
            transform: scale(1);
            opacity: 0.5;
        }
        50% {
            transform: scale(1.2);
            opacity: 0.7;
        }
    }
    
    @keyframes gradient-shift {
        0%, 100% {
            background-position: 0% 50%;
        }
        50% {
            background-position: 100% 50%;
        }
    }
    
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 768px) {
        .charts-container {
            grid-template-columns: 1fr;
        }
        
        .dashboard-title {
            font-size: 1.8rem;
        }
        
        .dashboard-subtitle {
            font-size: 1rem;
        }
        
        .stat-card {
            padding: 1rem;
        }
        
        .stat-value {
            font-size: 1.8rem;
        }
    }
    
    /* –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ */
    .back-btn {
        background: linear-gradient(45deg, #00d4ff, #0088ff);
        color: white;
        padding: 0.8rem 1.5rem;
        border: none;
        border-radius: 25px;
        text-decoration: none;
        display: inline-block;
        margin-bottom: 2rem;
        font-weight: bold;
        transition: all 0.3s;
        position: relative;
        z-index: 10;
        box-shadow: 0 5px 15px rgba(0, 212, 255, 0.3);
    }
    
    .back-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 212, 255, 0.5);
        color: white;
        text-decoration: none;
    }
    
    /* –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –±–µ–π–¥–∂–∏ */
    .tech-badges {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        justify-content: center;
        margin-bottom: 2rem;
        position: relative;
        z-index: 10;
    }
    
    .tech-badge {
        background: linear-gradient(45deg, #00d4ff, #0088ff);
        color: white;
        padding: 0.4rem 1rem;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: bold;
        box-shadow: 0 3px 10px rgba(0, 212, 255, 0.3);
        transition: all 0.3s;
    }
    
    .tech-badge:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 212, 255, 0.5);
    }
    
    /* –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö */
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }
    
    .loading-spinner {
        width: 80px;
        height: 80px;
        border: 5px solid rgba(0, 212, 255, 0.3);
        border-radius: 50%;
        border-top-color: #00d4ff;
        animation: spin 1s ease-in-out infinite;
    }
    
    .loading-text {
        margin-top: 1rem;
        color: #00d4ff;
        font-size: 1.2rem;
        font-weight: bold;
    }
    
    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }
    
    /* 3D —ç–ª–µ–º–µ–Ω—Ç—ã */
    .scene-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
        overflow: hidden;
    }
</style>
{% endblock %}

{% block content %}
<!-- –ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞...</div>
</div>

<!-- –§–æ–Ω–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã -->
<div id="particles-js" class="particles-bg"></div>
<div class="data-flow" id="dataFlow"></div>
<div class="scene-container" id="sceneContainer"></div>

<div class="finance-dashboard">
    <a href="{% url 'analytics:home' %}" class="back-btn">‚Üê –ù–∞–∑–∞–¥ –∫ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ</a>
    
    <div class="dashboard-header">
        <h1 class="dashboard-title">–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø–æ—Ç–æ–∫–æ–≤</h1>
        <p class="dashboard-subtitle">–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤</p>
    </div>
    
    <div class="tech-badges">
        <div class="tech-badge">Machine Learning</div>
        <div class="tech-badge">Data Visualization</div>
        <div class="tech-badge">Predictive Analytics</div>
        <div class="tech-badge">Financial Monitoring</div>
        <div class="tech-badge">Real-time Analysis</div>
    </div>
    
    <div class="stats-grid">
        <div class="stat-card" id="card1">
            <div class="stat-icon">üí∞</div>
            <div class="stat-value">{{ analytics.total_expenses|floatformat:0 }} ‚ÇΩ</div>
            <div class="stat-label">–û–±—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã</div>
        </div>
        <div class="stat-card" id="card2">
            <div class="stat-icon">üí∏</div>
            <div class="stat-value">{{ analytics.total_income|floatformat:0 }} ‚ÇΩ</div>
            <div class="stat-label">–û–±—â–∏–µ –¥–æ—Ö–æ–¥—ã</div>
        </div>
        <div class="stat-card" id="card3">
            <div class="stat-icon">üìä</div>
            <div class="stat-value">{{ analytics.avg_daily_expense|floatformat:0 }} ‚ÇΩ</div>
            <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –¥–Ω–µ–≤–Ω–æ–π —Ä–∞—Å—Ö–æ–¥</div>
        </div>
        <div class="stat-card" id="card4">
            <div class="stat-icon">üìà</div>
            <div class="stat-value">{{ analytics.records_count }}</div>
            <div class="stat-label">–ó–∞–ø–∏—Å–µ–π –≤ –∞–Ω–∞–ª–∏–∑–µ</div>
        </div>
    </div>
    
    <div class="charts-container">
        <div class="chart-wrapper" id="chart1">
            <div class="chart-title">–î–∏–Ω–∞–º–∏–∫–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤ –∏ –¥–æ—Ö–æ–¥–æ–≤</div>
            <div class="chart-canvas-container">
                <canvas id="financeChart"></canvas>
            </div>
        </div>
        
        <div class="chart-wrapper" id="chart2">
            <div class="chart-title">–ü—Ä–æ–≥–Ω–æ–∑ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ ML-–∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤</div>
            <div class="chart-canvas-container">
                <canvas id="predictionChart"></canvas>
            </div>
        </div>
    </div>
    
    <div class="projects-section" id="projectsSection">
        <h2 class="projects-header">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤</h2>
        <div class="projects-grid">
            <div class="project-card">
                <h3 class="project-name">–†–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–æ–º–∞</h3>
                <div class="project-budget">–ë—é–¥–∂–µ—Ç: 5,000,000 ‚ÇΩ</div>
                <div class="project-status status-active">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</div>
                
                <div class="risk-label">
                    <span>–†–∏—Å–∫ –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥–∞ –±—é–¥–∂–µ—Ç–∞</span>
                    <span>65%</span>
                </div>
                <div class="risk-meter">
                    <div class="risk-level risk-medium" style="width: 65%"></div>
                </div>
                
                <div class="risk-label">
                    <span>–†–∏—Å–∫ —Å—Ä—ã–≤–∞ —Å—Ä–æ–∫–æ–≤</span>
                    <span>42%</span>
                </div>
                <div class="risk-meter">
                    <div class="risk-level risk-medium" style="width: 42%"></div>
                </div>
                
                <div class="risk-label">
                    <span>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤</span>
                    <span>78%</span>
                </div>
                <div class="risk-meter">
                    <div class="risk-level risk-low" style="width: 78%"></div>
                </div>
            </div>
            
            <div class="project-card">
                <h3 class="project-name">–°–Ω–æ—Å —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–≥–æ –∫–æ–º–ø–ª–µ–∫—Å–∞</h3>
                <div class="project-budget">–ë—é–¥–∂–µ—Ç: 3,500,000 ‚ÇΩ</div>
                <div class="project-status status-active">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</div>
                
                <div class="risk-label">
                    <span>–†–∏—Å–∫ –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥–∞ –±—é–¥–∂–µ—Ç–∞</span>
                    <span>28%</span>
                </div>
                <div class="risk-meter">
                    <div class="risk-level risk-low" style="width: 28%"></div>
                </div>
                
                <div class="risk-label">
                    <span>–†–∏—Å–∫ —Å—Ä—ã–≤–∞ —Å—Ä–æ–∫–æ–≤</span>
                    <span>15%</span>
                </div>
                <div class="risk-meter">
                    <div class="risk-level risk-low" style="width: 15%"></div>
                </div>
                
                <div class="risk-label">
                    <span>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤</span>
                    <span>92%</span>
                </div>
                <div class="risk-meter">
                    <div class="risk-level risk-low" style="width: 92%"></div>
                </div>
            </div>
            
            <div class="project-card">
                <h3 class="project-name">–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –æ—Ñ–∏—Å–Ω–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∞</h3>
                <div class="project-budget">–ë—é–¥–∂–µ—Ç: 12,000,000 ‚ÇΩ</div>
                <div class="project-status status-planning">–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
                
                <div class="risk-label">
                    <span>–†–∏—Å–∫ –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥–∞ –±—é–¥–∂–µ—Ç–∞</span>
                    <span>85%</span>
                </div>
                <div class="risk-meter">
                    <div class="risk-level risk-high" style="width: 85%"></div>
                </div>
                
                <div class="risk-label">
                    <span>–†–∏—Å–∫ —Å—Ä—ã–≤–∞ —Å—Ä–æ–∫–æ–≤</span>
                    <span>72%</span>
                </div>
                <div class="risk-meter">
                    <div class="risk-level risk-high" style="width: 72%"></div>
                </div>
                
                <div class="risk-label">
                    <span>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤</span>
                    <span>45%</span>
                </div>
                <div class="risk-meter">
                    <div class="risk-level risk-medium" style="width: 45%"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="ml-insights" id="mlInsights">
        <h2 class="ml-insights-title">–ò–Ω—Å–∞–π—Ç—ã –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è</h2>
        
        <div class="insight-item">
            <div class="insight-icon">üîç</div>
            <div class="insight-text">–û–±–Ω–∞—Ä—É–∂–µ–Ω –∞–Ω–æ–º–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ "–†–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–æ–º–∞" (+18% –æ—Ç –ø–ª–∞–Ω–∞)</div>
        </div>
        
        <div class="insight-item">
            <div class="insight-icon">‚ö†Ô∏è</div>
            <div class="insight-text">–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ—Ç—Å—è –∑–∞–¥–µ—Ä–∂–∫–∞ –≤ –≥—Ä–∞—Ñ–∏–∫–µ –ø—Ä–æ–µ–∫—Ç–∞ "–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –æ—Ñ–∏—Å–Ω–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∞" –Ω–∞ 2-3 –Ω–µ–¥–µ–ª–∏</div>
        </div>
        
        <div class="insight-item">
            <div class="insight-icon">üí°</div>
            <div class="insight-text">–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫—É–ø–∫—É —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –∑–∞—Ç—Ä–∞—Ç –Ω–∞ 12%</div>
        </div>
        
        <div class="insight-item">
            <div class="insight-icon">üìà</div>
            <div class="insight-text">–í—ã—è–≤–ª–µ–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–≤–µ–ª–∏—á–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–∞–±–æ—á–µ–π —Å–∏–ª—ã –Ω–∞ 15%</div>
        </div>
    </div>
</div>

<script>
// –î–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
const chartData = {{ chart_data|safe }};

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∞
function generatePredictionData() {
    const data = [];
    const startDate = new Date();
    
    for (let i = 0; i < 6; i++) {
        const date = new Date(startDate);
        date.setMonth(date.getMonth() + i + 1);
        
        data.push({
            date: date.toISOString().slice(0, 10),
            expense: Math.floor(Math.random() * 300000) + 200000,
            income: Math.floor(Math.random() * 400000) + 250000,
            lowerBound: Math.floor(Math.random() * 150000) + 150000,
            upperBound: Math.floor(Math.random() * 500000) + 350000
        });
    }
    
    return data;
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Å—Ç–∏—Ü
document.addEventListener('DOMContentLoaded', function() {
    // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
    setTimeout(() => {
        const loadingOverlay = document.getElementById('loadingOverlay');
        gsap.to(loadingOverlay, {
            opacity: 0,
            duration: 1,
            onComplete: () => {
                loadingOverlay.style.display = 'none';
                initDashboard();
            }
        });
    }, 1500);
    
    function initDashboard() {
        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫
        gsap.to('.stat-card', {
            opacity: 1,
            y: 0,
            duration: 0.8,
            stagger: 0.2,
            ease: 'power3.out'
        });
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
        gsap.to('.chart-wrapper', {
            opacity: 1,
            y: 0,
            duration: 0.8,
            stagger: 0.3,
            delay: 0.5,
            ease: 'power3.out'
        });
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è —Å–µ–∫—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤
        gsap.to('#projectsSection', {
            opacity: 1,
            y: 0,
            duration: 0.8,
            delay: 1,
            ease: 'power3.out'
        });
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∏–Ω—Å–∞–π—Ç–æ–≤
        gsap.to('#mlInsights', {
            opacity: 1,
            y: 0,
            duration: 0.8,
            delay: 1.3,
            ease: 'power3.out'
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Å—Ç–∏—Ü
        particlesJS('particles-js', {
            particles: {
                number: {
                    value: 80,
                    density: {
                        enable: true,
                        value_area: 800
                    }
                },
                color: {
                    value: '#00d4ff'
                },
                shape: {
                    type: 'circle',
                    stroke: {
                        width: 0,
                        color: '#000000'
                    },
                    polygon: {
                        nb_sides: 5
                    }
                },
                opacity: {
                    value: 0.5,
                    random: true,
                    anim: {
                        enable: true,
                        speed: 1,
                        opacity_min: 0.1,
                        sync: false
                    }
                },
                size: {
                    value: 3,
                    random: true,
                    anim: {
                        enable: true,
                        speed: 2,
                        size_min: 0.1,
                        sync: false
                    }
                },
                line_linked: {
                    enable: true,
                    distance: 150,
                    color: '#00d4ff',
                    opacity: 0.2,
                    width: 1
                },
                move: {
                    enable: true,
                    speed: 1,
                    direction: 'none',
                    random: true,
                    straight: false,
                    out_mode: 'out',
                    bounce: false,
                    attract: {
                        enable: false,
                        rotateX: 600,
                        rotateY: 1200
                    }
                }
            },
            interactivity: {
                detect_on: 'canvas',
                events: {
                    onhover: {
                        enable: true,
                        mode: 'grab'
                    },
                    onclick: {
                        enable: true,
                        mode: 'push'
                    },
                    resize: true
                },
                modes: {
                    grab: {
                        distance: 140,
                        line_linked: {
                            opacity: 0.5
                        }
                    },
                    push: {
                        particles_nb: 4
                    }
                }
            },
            retina_detect: true
        });
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
        createDataFlows();
        
        // –°–æ–∑–¥–∞–Ω–∏–µ 3D —Å—Ü–µ–Ω—ã
        init3DScene();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
        initCharts();
    }
    
    function createDataFlows() {
        const dataFlow = document.getElementById('dataFlow');
        const numStreams = 30;
        
        for (let i = 0; i < numStreams; i++) {
            const stream = document.createElement('div');
            stream.className = 'data-stream';
            
            // –°–ª—É—á–∞–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ
            const left = Math.random() * 100;
            const delay = Math.random() * 5;
            const duration = 3 + Math.random() * 5;
            const width = 1 + Math.random() * 2;
            
            stream.style.left = `${left}%`;
            stream.style.width = `${width}px`;
            stream.style.animationDelay = `${delay}s`;
            stream.style.animationDuration = `${duration}s`;
            
            dataFlow.appendChild(stream);
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ —Å–≤–µ—á–µ–Ω–∏—è
        for (let i = 0; i < 5; i++) {
            const glow = document.createElement('div');
            glow.className = 'glow-effect';
            
            const left = Math.random() * 100;
            const top = Math.random() * 100;
            const delay = Math.random() * 5;
            
            glow.style.left = `${left}%`;
            glow.style.top = `${top}%`;
            glow.style.animationDelay = `${delay}s`;
            
            document.querySelector('.finance-dashboard').appendChild(glow);
        }
    }
    
    function init3DScene() {
        const container = document.getElementById('sceneContainer');
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã Three.js
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        
        const renderer = new THREE.WebGLRenderer({ alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0x000000, 0);
        container.appendChild(renderer.domElement);
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –≥–µ–æ–º–µ—Ç—Ä–∏–∏
        const geometry = new THREE.TorusKnotGeometry(10, 3, 100, 16);
        const material = new THREE.MeshBasicMaterial({ 
            color: 0x00d4ff,
            wireframe: true,
            transparent: true,
            opacity: 0.1
        });
        
        const torusKnot = new THREE.Mesh(geometry, material);
        scene.add(torusKnot);
        
        camera.position.z = 30;
        
        // –ê–Ω–∏–º–∞—Ü–∏—è
        function animate() {
            requestAnimationFrame(animate);
            
            torusKnot.rotation.x += 0.003;
            torusKnot.rotation.y += 0.005;
            
            renderer.render(scene, camera);
        }
        
        animate();
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    }
    
    function initCharts() {
        // –ì—Ä–∞—Ñ–∏–∫ —Ñ–∏–Ω–∞–Ω—Å–æ–≤
        const financeCtx = document.getElementById('financeChart').getContext('2d');
        
        // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        const labels = chartData.map(d => d.date);
        const expenseData = chartData.map(d => d.expense);
        const incomeData = chartData.map(d => d.income);
        
        new Chart(financeCtx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: '–†–∞—Å—Ö–æ–¥—ã',
                        data: expenseData,
                        borderColor: '#ff4444',
                        backgroundColor: 'rgba(255, 68, 68, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#ff4444',
                        pointBorderColor: '#fff',
                        pointRadius: 4,
                        pointHoverRadius: 6
                    },
                    {
                        label: '–î–æ—Ö–æ–¥—ã',
                        data: incomeData,
                        borderColor: '#44ff44',
                        backgroundColor: 'rgba(68, 255, 68, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#44ff44',
                        pointBorderColor: '#fff',
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            color: '#fff',
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleColor: '#00d4ff',
                        bodyColor: '#fff',
                        borderColor: '#00d4ff',
                        borderWidth: 1,
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    label += new Intl.NumberFormat('ru-RU', { style: 'currency', currency: 'RUB' }).format(context.parsed.y);
                                }
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#aaa'
                        }
                    },
                    y: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#aaa',
                            callback: function(value) {
                                return value.toLocaleString('ru-RU') + ' ‚ÇΩ';
                            }
                        }
                    }
                },
                interaction: {
                    mode: 'nearest',
                    axis: 'x',
                    intersect: false
                },
                animation: {
                    duration: 2000,
                    easing: 'easeOutQuart'
                }
            }
        });
        
        // –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–≥–Ω–æ–∑–∞
        const predictionCtx = document.getElementById('predictionChart').getContext('2d');
        const predictionData = generatePredictionData();
        
        const predLabels = predictionData.map(d => d.date);
        const predExpenseData = predictionData.map(d => d.expense);
        const predIncomeData = predictionData.map(d => d.income);
        const lowerBoundData = predictionData.map(d => d.lowerBound);
        const upperBoundData = predictionData.map(d => d.upperBound);
        
        new Chart(predictionCtx, {
            type: 'line',
            data: {
                labels: predLabels,
                datasets: [
                    {
                        label: '–ü—Ä–æ–≥–Ω–æ–∑ —Ä–∞—Å—Ö–æ–¥–æ–≤',
                        data: predExpenseData,
                        borderColor: '#ff4444',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        fill: false,
                        tension: 0.4,
                        pointBackgroundColor: '#ff4444',
                        pointBorderColor: '#fff',
                        pointRadius: 4
                    },
                    {
                        label: '–ü—Ä–æ–≥–Ω–æ–∑ –¥–æ—Ö–æ–¥–æ–≤',
                        data: predIncomeData,
                        borderColor: '#44ff44',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        fill: false,
                        tension: 0.4,
                        pointBackgroundColor: '#44ff44',
                        pointBorderColor: '#fff',
                        pointRadius: 4
                    },
                    {
                        label: '–ù–∏–∂–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞',
                        data: lowerBoundData,
                        borderColor: 'rgba(0, 212, 255, 0.5)',
                        backgroundColor: 'rgba(0, 212, 255, 0.1)',
                        borderWidth: 1,
                        fill: '+1',
                        tension: 0.4,
                        pointRadius: 0
                    },
                    {
                        label: '–í–µ—Ä—Ö–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞',
                        data: upperBoundData,
                        borderColor: 'rgba(0, 212, 255, 0.5)',
                        backgroundColor: 'rgba(0, 212, 255, 0.1)',
                        borderWidth: 1,
                        fill: false,
                        tension: 0.4,
                        pointRadius: 0
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            color: '#fff',
                            font: {
                                size: 12
                            },
                            filter: function(item) {
                                // –°–∫—Ä—ã–≤–∞–µ–º –≥—Ä–∞–Ω–∏—Ü—ã –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –∏–∑ –ª–µ–≥–µ–Ω–¥—ã
                                return !item.text.includes('–≥—Ä–∞–Ω–∏—Ü–∞');
                            }
                        }
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleColor: '#00d4ff',
                        bodyColor: '#fff',
                        borderColor: '#00d4ff',
                        borderWidth: 1
                    }
                },
                scales: {
                    x: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#aaa'
                        }
                    },
                    y: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#aaa',
                            callback: function(value) {
                                return value.toLocaleString('ru-RU') + ' ‚ÇΩ';
                            }
                        }
                    }
                },
                interaction: {
                    mode: 'nearest',
                    axis: 'x',
                    intersect: false
                },
                animation: {
                    duration: 2000,
                    easing: 'easeOutQuart'
                }
            }
        });
    }
});
</script>
{% endblock %}