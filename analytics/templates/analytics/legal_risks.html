{% extends 'base/base.html' %}
{% load static %}

{% block title %}Анализ юридических рисков в Договорах{% endblock %}

{% block extra_css %}
<style>
    body {
        background-color: #1a1a2e;
        color: #e6e6e6;
    }
    
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .header-section {
        background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
        padding: 30px;
        border-radius: 10px;
        margin-bottom: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        animation: gradientBG 15s ease infinite;
        background-size: 400% 400%;
    }
    
    @keyframes gradientBG {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }
    
    .contract-section {
        display: flex;
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .contract-viewer {
        flex: 2;
        background-color: #16213e;
        border-radius: 10px;
        padding: 20px;
        height: 500px;
        overflow-y: auto;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .risk-summary {
        flex: 1;
        background-color: #16213e;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .risk-card {
        background-color: #1f305e;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        border-left: 5px solid transparent;
        transition: transform 0.3s;
    }
    
    .risk-card:hover {
        transform: translateY(-5px);
    }
    
    .risk-high {
        border-left-color: #e74c3c;
    }
    
    .risk-medium {
        border-left-color: #f39c12;
    }
    
    .risk-low {
        border-left-color: #2ecc71;
    }
    
    .risk-badge {
        display: inline-block;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
        margin-bottom: 10px;
    }
    
    .badge-high {
        background-color: #e74c3c;
    }
    
    .badge-medium {
        background-color: #f39c12;
    }
    
    .badge-low {
        background-color: #2ecc71;
    }
    
    .metrics-section {
        display: flex;
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .metric-card {
        flex: 1;
        background-color: #16213e;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .metric-value {
        font-size: 2.5rem;
        font-weight: bold;
        margin: 10px 0;
        background: linear-gradient(45deg, #3498db, #2ecc71);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    
    .charts-section {
        display: flex;
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .chart-container {
        flex: 1;
        background-color: #16213e;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        height: 350px;
    }
    
    .recommendations-section {
        background-color: #16213e;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .recommendation-item {
        display: flex;
        align-items: flex-start;
        margin-bottom: 15px;
        padding: 15px;
        background-color: #1f305e;
        border-radius: 8px;
        transition: transform 0.3s;
    }
    
    .recommendation-item:hover {
        transform: translateY(-3px);
    }
    
    .recommendation-icon {
        font-size: 2rem;
        margin-right: 15px;
    }
    
    .highlight {
        background-color: rgba(231, 76, 60, 0.3);
        padding: 2px;
        border-radius: 3px;
        cursor: pointer;
        position: relative;
    }
    
    .highlight:hover {
        background-color: rgba(231, 76, 60, 0.5);
    }
    
    .tooltip {
        display: none;
        position: absolute;
        background-color: #34495e;
        color: white;
        padding: 10px;
        border-radius: 5px;
        width: 250px;
        z-index: 100;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    .highlight:hover .tooltip {
        display: block;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="header-section">
        <h1>Анализ юридических рисков в Договорах</h1>
        <p>NLP-анализ договорной документации для выявления потенциальных правовых рисков</p>
    </div>
    
    <div class="contract-section">
        <div class="contract-viewer">
            <h3>ДОГОВОР ПОДРЯДА №2025-07-001</h3>
            <p>г. Москва                                                                                                                  15 июля 2025 г.</p>
            <p>ООО "СтройИнвест", именуемое в дальнейшем "Заказчик", в лице генерального директора Иванова И.И., действующего на основании Устава, с одной стороны, и</p>
            <p>ООО "СтройПодряд", именуемое в дальнейшем <span class="highlight">"Подрядчик", в лице директора Петрова П.П., действующего на основании доверенности №123 от 01.06.2025<span class="tooltip">Риск: Отсутствует указание на срок действия доверенности.</span></span>, с другой стороны,</p>
            <p>заключили настоящий договор о нижеследующем:</p>
            <p>1. ПРЕДМЕТ ДОГОВОРА</p>
            <p>1.1. Заказчик поручает, а Подрядчик принимает на себя обязательства по выполнению строительно-монтажных работ на объекте "Реконструкция административного здания", расположенного по адресу: г. Москва, ул. Строителей, д. 10.</p>
            <p>2. СТОИМОСТЬ РАБОТ</p>
            <p>2.1. Стоимость работ по настоящему договору определяется согласно Смете (Приложение №1) и составляет <span class="highlight">5 000 000 (Пять миллионов) рублей, без учета НДС<span class="tooltip">Риск: Неясно указание по НДС.</span></span>.</p>
            <p>2.2. Окончательная стоимость работ определяется <span class="highlight">по фактически выполненным объемам работ<span class="tooltip">Риск: Высокий. Отсутствует механизм согласования изменения стоимости.</span></span>.</p>
        </div>
        
        <div class="risk-summary">
            <h3>Сводка рисков</h3>
            
            <div class="risk-card risk-high">
                <span class="risk-badge badge-high">Высокий риск</span>
                <h4>Неопределенность стоимости работ</h4>
                <p>Пункт 2.2 договора не устанавливает предельных отклонений от сметной стоимости.</p>
            </div>
            
            <div class="risk-card risk-medium">
                <span class="risk-badge badge-medium">Средний риск</span>
                <h4>Несбалансированная ответственность</h4>
                <p>Ответственность заказчика за просрочку платежа в 10 раз выше ответственности подрядчика.</p>
            </div>
            
            <div class="risk-card risk-low">
                <span class="risk-badge badge-low">Низкий риск</span>
                <h4>Короткий гарантийный срок</h4>
                <p>Гарантийный срок составляет 12 месяцев, что меньше рекомендуемого для строительных работ.</p>
            </div>
        </div>
    </div>
    
    <div class="metrics-section">
        <div class="metric-card">
            <div>Общий индекс риска</div>
            <div class="metric-value">68%</div>
            <div>Выше среднего</div>
        </div>
        
        <div class="metric-card">
            <div>Выявлено рисков</div>
            <div class="metric-value">8</div>
            <div>В документе</div>
        </div>
        
        <div class="metric-card">
            <div>Высоких рисков</div>
            <div class="metric-value">1</div>
            <div>Требуют внимания</div>
        </div>
        
        <div class="metric-card">
            <div>Точность анализа</div>
            <div class="metric-value">92%</div>
            <div>На основе ML-модели</div>
        </div>
    </div>
    
    <div class="charts-section">
        <div class="chart-container">
            <h3>Распределение рисков по категориям</h3>
            <canvas id="riskCategoryChart"></canvas>
        </div>
        
        <div class="chart-container">
            <h3>Сравнение с отраслевыми стандартами</h3>
            <canvas id="industryComparisonChart"></canvas>
        </div>
    </div>
    
    <div class="recommendations-section">
        <h3>Рекомендации по снижению рисков</h3>
        
        <div class="recommendation-item">
            <div class="recommendation-icon">⚖️</div>
            <div>
                <h4>Уточнить механизм изменения стоимости</h4>
                <p>Установить предельные отклонения от сметной стоимости (не более 10%) и процедуру согласования дополнительных работ.</p>
            </div>
        </div>
        
        <div class="recommendation-item">
            <div class="recommendation-icon">📋</div>
            <div>
                <h4>Разработать детальный график работ</h4>
                <p>Включить в договор приложение с графиком выполнения работ, разбитым на этапы с промежуточными сроками и результатами.</p>
            </div>
        </div>
        
        <div class="recommendation-item">
            <div class="recommendation-icon">⏱️</div>
            <div>
                <h4>Сбалансировать ответственность сторон</h4>
                <p>Установить одинаковый размер неустойки для обеих сторон (рекомендуется 0,05% за каждый день просрочки).</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // График распределения рисков по категориям
        const riskCategoryCtx = document.getElementById('riskCategoryChart').getContext('2d');
        new Chart(riskCategoryCtx, {
            type: 'doughnut',
            data: {
                labels: ['Финансовые риски', 'Сроки выполнения', 'Ответственность сторон', 'Гарантийные обязательства', 'Прочие риски'],
                datasets: [{
                    data: [35, 25, 20, 15, 5],
                    backgroundColor: [
                        '#e74c3c',
                        '#f39c12',
                        '#2ecc71',
                        '#3498db',
                        '#9b59b6'
                    ]
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: '#e6e6e6'
                        }
                    }
                }
            }
        });
        
        // График сравнения с отраслевыми стандартами
        const industryComparisonCtx = document.getElementById('industryComparisonChart').getContext('2d');
        new Chart(industryComparisonCtx, {
            type: 'radar',
            data: {
                labels: ['Финансовые условия', 'Сроки', 'Ответственность', 'Гарантии', 'Разрешение споров'],
                datasets: [{
                    label: 'Текущий договор',
                    data: [65, 40, 30, 45, 70],
                    backgroundColor: 'rgba(52, 152, 219, 0.2)',
                    borderColor: 'rgba(52, 152, 219, 1)',
                    pointBackgroundColor: 'rgba(52, 152, 219, 1)'
                }, {
                    label: 'Отраслевой стандарт',
                    data: [80, 75, 70, 85, 90],
                    backgroundColor: 'rgba(46, 204, 113, 0.2)',
                    borderColor: 'rgba(46, 204, 113, 1)',
                    pointBackgroundColor: 'rgba(46, 204, 113, 1)'
                }]
            },
            options: {
                responsive: true,
                scales: {
                    r: {
                        angleLines: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        pointLabels: {
                            color: '#e6e6e6'
                        },
                        ticks: {
                            color: '#e6e6e6',
                            backdropColor: 'transparent'
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: '#e6e6e6'
                        }
                    }
                }
            }
        });
    });
</script>
{% endblock %}