{% extends 'base/base.html' %}

{% block title %}Мои организации{% endblock %}

{% block extra_styles %}
.organization-list { 
    list-style: none; 
    padding: 0; 
    max-width: 800px;
    margin: 0 auto;
}
.organization-item { 
    padding: 20px; 
    margin-bottom: 15px; 
    border: 1px solid rgba(255, 255, 255, 0.2); 
    border-radius: 10px; 
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    transition: all 0.3s;
}
.organization-item:hover { 
    background: rgba(255, 255, 255, 0.2); 
    transform: translateY(-2px);
}
.organization-link { 
    text-decoration: none; 
    color: white; 
    font-weight: bold; 
    font-size: 24px;
    display: block;
}
.organization-link:hover { 
    color: #e3f2fd; 
    text-decoration: none;
}
.organization-inn { 
    color: rgba(255, 255, 255, 0.8); 
    font-size: 16px; 
    margin-top: 8px;
}
.page-title {
    text-align: center;
    color: white;
    font-size: 3rem;
    margin-bottom: 3rem;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}
.delete-btn {
    background: rgba(231, 76, 60, 0.8);
    color: white;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.3s;
}
.delete-btn:hover {
    background: rgba(231, 76, 60, 1);
    transform: scale(1.1);
}
{% endblock %}

{% block content %}
<div class="page-title">Мои организации</div>

<ul class="organization-list">
    {% for organizaciya in organizacii %}
    <li class="organization-item">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <a href="{% url 'sotrudniki:organization_detail' organizaciya.pk %}" class="organization-link">
                {{ organizaciya.nazvanie }}
            </a>
            <button onclick="deleteOrganization({{ organizaciya.id }})" class="delete-btn" title="Удалить организацию">✗</button>
        </div>
        <div class="organization-inn">ИНН: {{ organizaciya.inn }}</div>
    </li>
    {% empty %}
    <li class="organization-item">
        <div style="text-align: center; color: rgba(255, 255, 255, 0.7);">Нет организаций</div>
    </li>
    {% endfor %}
</ul>

<script>
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function deleteOrganization(organizationId) {
    if (confirm('Вы уверены, что хотите удалить эту организацию?')) {
        fetch(`/sotrudniki/organization/${organizationId}/delete/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken'),
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Ошибка при удалении: ' + data.error);
            }
        })
        .catch(error => {
            alert('Ошибка: ' + error);
        });
    }
}
</script>

{% endblock %}