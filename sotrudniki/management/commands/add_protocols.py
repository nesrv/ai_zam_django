from django.core.management.base import BaseCommand
from datetime import date


class Command(BaseCommand):
    help = 'Добавляет протоколы обучения всем сотрудникам'

    def handle(self, *args, **options):
        protocols_data = [
            ("2025/СТ.01-0005", "Стажировка на рабочем месте", "-"),
            ("2024/В.06-0006", "В-Безопасные методы и приемы выполнения работ, связанные с эксплуатацией сосудов, работающих под избыточным давлением", "98625049"),
            ("2025/В.05-0001", "В-Безопасные методы и приемы выполнения строительных работ, в том числе: - окрасочные работы - электросварочные и газосварочные работы", "97999118"),
            ("2025/В.03-0001", "В-Безопасные методы и приемы выполнения работ в электроустановках", "97879462"),
            ("2025/В.02-0001", "В-Безопасные методы и приемы выполнения огневых работ", "97472399"),
            ("2025/В.01-0001", "В-Безопасные методы и приемы выполнения газоопасных работ", "97290038"),
            ("2024/В.07-0007", "В-Безопасные методы и приемы выполнения ремонтных, монтажных и демонтажных работ зданий и сооружений", "96646302"),
            ("2024/В.04-0007", "В-Безопасные методы и приемы выполнения работ на высоте", "96508193"),
            ("2024/БМ-0002", "Б-Безопасные методы и приемы выполнения работ при воздействии вредных и (или) опасных производственных факторов, источников опасности, идентифицированных в рамках специальной оценки условий труда и оценки профессиональных рисков", "95796762"),
            ("2024/ОПП-0002", "Оказание первой помощи пострадавшим", "94554099"),
            ("2024/СИЗ-0001", "Использование (применение) средств индивидуальной защиты", "94043814"),
        ]

        for sotrudnik in Sotrudnik.objects.all():
            dokumenty, created = DokumentySotrudnika.objects.get_or_create(sotrudnik=sotrudnik)
            
            for nomer, kurs, reg_nomer in protocols_data:
                ProtokolyObucheniya.objects.get_or_create(
                    dokumenty_sotrudnika=dokumenty,
                    nomer_programmy=nomer,
                    defaults={
                        'nazvanie_kursa': kurs,
                        'tekst_protokola': f'Протокол обучения по программе {nomer}',
                        'data_prikaza': date(2024, 1, 1),
                        'registracionnyy_nomer': reg_nomer
                    }
                )
            
            self.stdout.write(f'Добавлены протоколы для {sotrudnik.fio}')

        self.stdout.write(self.style.SUCCESS('Протоколы добавлены всем сотрудникам'))